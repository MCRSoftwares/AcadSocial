{% extends 'base-logado-com-topo.html' %}
{% load staticfiles %}

{% block title %} {% endblock %}

{% block head %}
    <script src="{% static 'jquery/1.11.1/plugins/autosize/jquery.autosize.min.js' %}"></script>
    <script type="text/javascript">
        $(document).ready(function(){
            $('textarea').autosize();

            $(document).scrollTop($.cookie("scroll"));

            $(window).on("scroll", function() {
                $.cookie("scroll", $(document).scrollTop());
            });

        });

        sendForm = function(formID) {
            $(formID).keypress(function(e) {
                if(e.which == 13 && !e.shiftKey) {
                    this.form.submit();
                }
            });
        };

    </script>
{% endblock %}

{% block home-active %}
    class='lista-active'
{% endblock %}

{% block body %}
    <div class="vertical-space">
        <div class="col-xs-4">
            <div class="panel panel-default panel-bordeless">
                <div class="panel-heading">
                    <i class="fa fa-group"></i> Meus Grupos
                </div>
                <ul class="panel-list">
                    {% if grupos_participa|length == 0 %}
                        <li class="text-center not-link-list">Você não tem/participa de nenhum grupo!</li>
                    {% else %}
                        {% for participa in grupos_participa|slice:':10' %}
                            <li><a href="{% url 'grupo-index' participa.grupo.gid %}">{{ participa.grupo.nome }}</a></li>
                        {% endfor %}
                    {% endif %}
                </ul>
                <ul class="text-center">
                    {% if grupos_participa|length == 0 %}
                        <li><a href="{% url 'grupos-lista' %}" class="panel-footer">Criar/Participar de Grupos</a></li>
                    {% else %}
                        <li><a href="{% url 'grupos-lista' %}" class="panel-footer">Ver Todos</a></li>
                    {% endif %}
                </ul>
            </div>
            <div class="panel panel-default panel-bordeless">
                <div class="panel-heading">
                    <i class="fa fa-paint-brush"></i> Meus Interesses
                </div>
                <ul class="panel-list">
                    {% if interesses_possui|length == 0 %}
                        <li class="text-center not-link-list">Você não possui interesses!</li>
                    {% else %}
                        {% for possui in interesses_possui|slice:':10' %}
                            <li><a href="{% url 'interesse-index' possui.interesse.iid %}">{{ possui.interesse.interesse }}</a></li>
                        {% endfor %}
                    {% endif %}
                </ul>
                <ul class="text-center">
                    {% if interesses_possui|length == 0 %}
                        <li><a href="{% url 'interesses' %}" class="panel-footer">Adicionar Interesses</a></li>
                    {% else %}
                        <li><a href="{% url 'interesses' %}" class="panel-footer">Ver Todos</a></li>
                    {% endif %}
                </ul>
            </div>
        </div>

        <div class="col-xs-8" id="feed">
            {% for postagem, postagem_foto in postagens %}
                <div class="col-xs-8 no-right-padding no-left-padding">
                    <div class="panel panel-default panel-bordeless feed">
                        <div class="panel-heading truncate">
                            <a href=""><span class="glyphicon glyphicon-edit"></span> {{ postagem.titulo }}</a>
                        </div>
                        <div class="panel-body text-left truncate-line feed-group">
                             {{ postagem.conteudo }}
                        </div>
                        <div class="panel-footer">
                            <form method="post" action="">
                                {% csrf_token %}
                                <div class="form-group">

                                    <textarea name="comentario" class="comment-bar form-control comment-bar-focus"
                                              id="commentTA-{{ postagem.pid }}" maxlength="256"
                                              placeholder="Comentar..."
                                              onkeypress="sendForm('#commentTA-{{ postagem.pid }}')"></textarea>
                                    <input name="postagem-{{ postagem.pid }}" type="text" style="display: none;">
                                </div>
                            </form>
                        </div>
                        {% for comentario, comentario_foto in comentarios %}
                            {% if comentario.postagem == postagem %}
                                <div class="panel-body comment-start" style="padding:10px;">
                                    <div class="col-xs-1" style="padding:0;">
                                        <a href="">
                                            <img src="/media/{{ comentario_foto.thumbnail }}" class="profile-image">
                                        </a>
                                    </div>
                                    <div class="col-xs-11 comment-user">
                                        &nbsp&nbsp&nbsp<a href="">{{ comentario.criado_por.full_name }}</a><br>
                                        <div class="col-xs-offset-1">
                                            {{ comentario.conteudo }}
                                        </div>
                                        <div class="col-xs-12 text-right no-padding comment-datetime">
                                            <br>
                                            {{ comentario.data_criacao|date:"d/m/Y - H:i" }}
                                        </div>
                                    </div>
                                </div>
                            {% endif %}
                        {% endfor %}
                    </div>
                </div>
                <div class="col-xs-4">
                    <div class="panel panel-default panel-bordeless">
                        <div class="panel-heading truncate text-center">
                            <a href=""><span class="fa fa-group"></span> {{ postagem.grupo.nome }}</a>
                        </div>
                        <div class="panel-body text-center truncate">
                            <A href="" class="feed-link">
                                <img src="/media/{{ postagem_foto.thumbnail_home }}" class="profile-image">
                                <br>
                                {{ postagem.criado_por.full_name }}
                            </a>
                            <br>
                            <span class="feed-datetime">{{ postagem.data_criacao|date:"d/m/Y - H:i" }}</span>
                        </div>
                    </div>
                </div>
            {% endfor %}
        </div>

    </div>
{% endblock %}